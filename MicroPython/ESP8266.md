
# ESP8266 MicroPython Quickstart

Bits and pieces for running MicroPython on a LoLin ESP8266 (NodeMcu V3)

These experiments where done on a Ubuntu 18.10 AMD64 virual machine. 


### Load MicroPython to the MCU

A few tools.
The tools you need can be installed with the Python pip package manager.
https://en.wikipedia.org/wiki/Pip_(package_manager)

To upload the MicroPython enviromnet to the MCU use the esptool. In the commands below the device came up as /dev/ttyUSB0.
To load files to the system after installing Micropython to the target you can use the ampy tool from Adafruit.

Install the tools as below and download the MircroPython binary from here : http://micropython.org/download#esp8266
For this experiment i used "esp8266-20180511-v1.9.4.bin"
More information on the official pages : https://docs.micropython.org/en/latest/esp8266/tutorial/intro.html

```
sudo apt install python-pip
pip install esptool adafruit-ampy

wget http://micropython.org/resources/firmware/esp8266-20180511-v1.9.4.bin

esptool.py --port /dev/ttyUSB0 erase_flash
esptool.py --port /dev/ttyUSB0 --baud 460800 write_flash --flash_size=detect 0 esp8266-20180511-v1.9.4.bin
```

### Nice to know
```
Ctrl+D   - Do a soft reboot of the MCU
```


### Default files in the filesystem
```
boot.py - First file to load
main.py - Loads after boot.py have been executed
```

### The LoLin NodeMcu V3 module
![NodeMCU V3](https://i1.wp.com/www.teachmemicro.com/wp-content/uploads/2018/04/NodeMCUv3.0-pinout.jpg?resize=768%2C507&ssl=1)

The ESP-12 module onboard LED is on GPIO2  (Note active low LED)

### BLINK LED EXAMPLE

```Python
# Blink the internal LoLin LED
from machine import Pin
from time import sleep

# GPIO2 (D4) is the internal LED for the ESP-12 module
# This LED is active low
led = Pin(2, Pin.OUT)

while True:
    led.on()
    sleep(1)
    led.off()
    sleep(1)


# Small modification of code from https://github.com/lvidarte/esp8266/wiki/MicroPython:-LED
```


Save this as blink.py then run the file with the ampy tool.
```
ampy --port /dev/ttyUSB0 run blink.py
```

Upload the file to the target filesystem
```
ampy --port /dev/ttyUSB0 put blink.py 
```

### Read pushbutton value
```Python
# Set internal LED with the FLASH pushbutton
from machine import Pin

# GPIO2 (D4) is the internal LED for the ESP-12 module, This LED is active low
# GPIO0 (D3) is the FLASH pushbutton on the LoLin module, push/active low
# 

led = Pin(2, Pin.OUT)
button = Pin(0, Pin.IN, Pin.PULL_UP)


while True:
    if not button.value():  # Active low when button is pushed
        led.off()           # Light up the LED
    else:
        led.on()            # No light
```


### Connect to WLAN
```Python
import network
sta_if = network.WLAN(network.STA_IF)
sta_if.active(True)
sta_if.connect('<your ESSID>', '<your password>')

From : https://docs.micropython.org/en/latest/esp8266/tutorial/network_basics.html
```
